language: r
branches:
  only:
  - draft
env:
  global:
  - default_branch_scenario: published/subcountry2014
  - study_area: Colombia
  - secure: WZHMbpAOtMeyIx3G5dTAptJ6DjFBGxj8I+eTqDCD1BZBF2XdN2jHoQkfrqn6qZ4FnuAxp44P7TbLsrsfvw51JUfHycQP24/13iAzk6fszpiPAOgGgIJ1wnJ781j1PQGVDZxeljyP5vUb+HdHOT7Oy/nIks5E/s5HlL1wUYME0jA=
matrix:
  fast_finish: true
before_install:
- curl -OL http://raw.github.com/craigcitro/r-travis/master/scripts/travis-tool.sh
- curl -OL http://raw.github.com/OHI-Science/ohi-webapps/master/ohi-travis-functions.R
- chmod 755 ./travis-tool.sh
- ./travis-tool.sh bootstrap
- git config --global user.email "lowndes@nceas.ucsb.edu"
- git config --global user.name "Julia Lowndes"

apt_packages:
- pandoc

r_packages:
- devtools
- zoo
- psych
- tidyr
- brew
- rmarkdown
- httr
- git2r

r_github_packages:
- ohi-science/rCharts
- ohi-science/ohicore@dev

script:
# execute as a sequence, so if any fail, none of the subsequent commands are executed
- Rscript ohi-travis-functions.R calculate_scores &&
  Rscript ohi-travis-functions.R create_results &&
  Rscript ohi-travis-functions.R push_branch draft &&
  Rscript ohi-travis-functions.R push_branch published &&
  Rscript ohi-travis-functions.R create_pages
  
after_failure:
- ./travis-tool.sh dump_logs
notifications:
  email:
    recipients:
    - bbest@nceas.ucsb.edu
    - lowndes@nceas.ucsb.edu
    on_success: change
    on_failure: always
